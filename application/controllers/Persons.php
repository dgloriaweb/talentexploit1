<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Persons extends CI_Controller {

    public function register(){
        
        $data['title'] = 'Sign Up';
        $data['person_logged_in'] = false;
        $this->form_validation->set_rules('username','Username', 'required|min_length[5]');
        $this->form_validation->set_rules('email','Email', 'required|min_length[5]|valid_email|is_unique[persons.email]');
        $this->form_validation->set_rules('password','Password', 'required|min_length[8]');
        $this->form_validation->set_rules('password2','Confirm Password', 'required|min_length[8]|matches[password]');

        if ($this->form_validation->run()) {
            $enc_password = password_hash($this->input->post('password'), PASSWORD_BCRYPT, ['cost' => 11]);
            $this->person_model->register($enc_password);
            
            //set message
            $this->session->set_flashdata('user_registered', 'You are now registered and can log in');

            redirect('persons');

        } else {
            $this->load->view('register_view',$data);
        }
    }
}