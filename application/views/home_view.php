<?php include 'header.php'; ?>
<?php if (!$this->session->userdata('logged_in')) : ?>
	<?= validation_errors(); ?>

	Welcome. You are not logged in.<br />

	<!-- here we need to check if user is logged in -->
<?php else : ?>

	<!-- there are more results for a drivers license just as every other property -->
	<!-- later we need to simplify this and do only one foreach for all properties that is not null -->
	<h2>Welcome <?= $this->session->userdata('username') ?></h2>

	<!--
  Here we need to show a dashboardish style progress on the info given, and if we are able to recommend a position yet.
 -->
	<?php if ($jobs[0]['job_rate'] < 50) : ?>
		<p>
			You haven't got a job that matches more than 90%, is it because you didn't provide enough data? Based on that I
			cannot give you recommendation for a future role. Please scroll down and fill in more data to continue.
		</p>
	<?php else : ?>
		<div class="card">
			<h2>Recommended jobs</h2>
			<?php foreach ($jobs as $job) : ?>
				<div class="card-text">
					<a href=<?= base_url("job_user/index/" . $job['job_id']) ?>><?= $job['job_name'] ?></a>

					<span class="badge badge-success"><?= $job['job_rate'] ?>%</span>
				</div>

			<?php endforeach ?>
		</div>
	<?php endif ?>

	<div>
		<br>
		<br>
		<br>


		<!-- <h4>More...<h4> -->
	</div>
	<h2>Your settings</h2>


	<div class="container">
		<br>
		<h3>Personal properties</h3>
		<br>
		<!-- ******************************************* -->
		<!-- ***  Main list of not found properties *** -->
		<!-- ******************************************* -->
		<!-- if no driving data found -->
		<?php if (!array_key_exists('drivers_license', $properties)) : ?>
			<div class="main_info_items">
				<img src=<?= base_url("/images/cancel_o_s.png") ?> class="beaicons" data-toggle="tooltip" data-placement="left" title="Data missing">
				<a href="persons/drivers_license/detail"><img src=<?= base_url("/images/edit_s2.png") ?> class="beaicons" data-toggle="tooltip" data-placement="left" title="Edit"></a>
				<span class="prop-title"> Drivers License</span>
				<br>

			</div>
		<?php endif ?>

		<!-- if no skills found -->
		<?php if (!array_key_exists('skill', $properties)) : ?>
			<div class="main_info_items">
				<img src=<?= base_url("/images/cancel_o_s.png") ?> class="beaicons" data-toggle="tooltip" data-placement="left" title="Data missing">
				<a href="persons/skills/detail"><img src=<?= base_url("/images/edit_s2.png") ?> class="beaicons" data-toggle="tooltip" data-placement="left" title="Edit"></a>
				<span class="prop-title"> Skills</span>
				<br>
			</div>
		<?php endif ?>

		<!-- ********************************* -->
		<!-- *** Show person's properties  *** -->
		<!-- ********************************* -->

		<?php foreach ($properties as $property => $value) : ?>

			<!-- **************** Drivers' licenses ******************** -->
			<?php if ($property == 'drivers_license') : ?>
				<div class="main_info_items">
					<!-- header -->
					<div class="prop_dropdown" data-toggle="collapse" data-target="#demo1">
						<img src=<?= base_url("/images/confirm_b_s.png") ?> class="beaicons" data-toggle="tooltip" data-placement="left" title="Open"><i class="fa fa-plus"></i> <span class="prop-title">
							Drivers'
							Licenses</span>
					</div>
					<!-- data grid -->
					<div id="demo1" class="collapse hide">
						<div class="container">
							<a href="persons/drivers_license/detail"><img src=<?= base_url("/images/edit_s2.png") ?> class="beaicons" data-toggle="tooltip" data-placement="left" title="Edit"></a>
							Details
							<div class="container">
								<div class="row">
									<div class="col">
										Drivers' license type
									</div>
									<div class="col">
										Years of experience
									</div>
								</div>
								<?php foreach ($value as $items) : ?>
									<div class="row">
										<div class="col details-grid">
											<?= $items['drivers_license'] ?>
										</div>
										<div class="col details-grid">
											<?= $items['driving_years'] ?>
										</div>
									</div>
								<?php endforeach ?>
							</div>
						</div>
					</div>
					<br>
				</div>

			<?php endif ?>
			<!-- **************** Drivers' licenses END ******************** -->

			<!-- **************** Skills ******************** -->
			<?php if ($property == 'skill') : ?>
				<div class="main_info_items">
					<!-- header -->
					<div class="prop_dropdown" data-toggle="collapse" data-target="#demo6">
						<img src=<?= base_url("/images/confirm_b_s.png") ?> class="beaicons" data-toggle="tooltip" data-placement="left" title="Open"><i class="fa fa-plus"></i> <span class="prop-title">
							Skills</span>
					</div>
					<!-- data grid -->
					<div id="demo6" class="collapse hide main_info_items">
						<div class="container">
							<a href="persons/skills/detail"><img src=<?= base_url("/images/edit_s2.png") ?> class="beaicons" data-toggle="tooltip" data-placement="left" title="Edit"></a>
							Details
							<div class="container">
								<div class="row">
									<div class="col">
										Skill description
									</div>
								</div>
								<?php foreach ($value as $items) : ?>
									<div class="row">
										<div class="col details-grid">
											<?= $items['skill_name'] ?>
										</div>
									</div>
								<?php endforeach ?>
							</div>
						</div>
					</div>
					<br>
				</div>
			<?php endif ?>

			<!--  **************** Skills END ******************** -->

		<?php endforeach ?>
		<!-- END *** Show person's properties  *** -->


		<br>
		<br>



		<!-- ******************************************* -->
		<!-- ***        Work preferences             *** -->
		<!-- ******************************************* -->
		<h3>Your work hour and day preferences</h3>
<br>
		<div class="accordion" id="myAccordion">
			<div class="row">
				<?php foreach ($workprefs_array as $type => $value) : ?>
					<div class="col-12 col-md-3 workprefs">
						<h5><?= $type ?></h5>
						<ul class="list-group">
							<?php foreach ($workprefs_array[$type] as $value) : ?>
							<?php //echo '<pre>'; var_dump($value); echo '</pre>'; die;?>
								<?php if ($work_details[$value] == 1) : ?>
									<?php if ($work_details[$value] == $work_details[$value]) : ?>
										<li class="list-group-item"><?= $value ?>
											<img src=<?= base_url("/images/confirm_b_s.png") ?> class="beaicons" data-toggle="tooltip" data-placement="right" title="Match">
										</li>
									<?php else : ?>
										<li class="list-group-item"><?= $value ?>
											<img src=<?= base_url("/images/cancel_o_s.png") ?> class="beaicons" data-toggle="tooltip" data-placement="right" title="No match">
										</li>
									<?php endif ?>
								<?php else : ?>
									<?php if ($type == 'overtime') : ?>
										<li class="list-group-item">Not Required</li>
									<?php endif ?>

								<?php endif ?>
							<?php endforeach ?>
						</ul>
					</div>

				<?php endforeach ?>

			</div>
			<br>
			<!-- work preferences dropdown -->
			<div class="accordion" id="myAccordion">
				<div class="row">
					<a class="btn btn-outline-info" data-toggle="collapse" href="#collapseExample" role="button" data-parent="#myAccordion" aria-expanded="false" aria-controls="collapseExample">
						Edit your overtime and work hour preferences <i class="fa fa-caret-down"></i>
					</a>
				</div>
				<div class="row">
					<div class="collapse" id="collapseExample">
						<div class="card card-body">
							<?php include 'includes/edit_workprefs_view.php'; ?>
						</div>
					</div>
				</div>
				<hr>
			</div>
		</div>
		<!--  **************** Work hour preferences END ******************** -->

	<?php endif ?>
	</div>


	<?php include 'footer.php'; ?>