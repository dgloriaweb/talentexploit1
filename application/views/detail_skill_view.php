<?php include 'header.php';?>
<?= validation_errors(); ?>

<h1>Skills</h1>
<div class="col-md-6">
	<table class="table table-primary">
		<tr>
			<th></th>
			<th>Description</th>
		</tr>
		<?php if($skills) : ?>
		<?php foreach ($skills as $skill): ?>
		<tr>
			<td>
				<a href="<?=base_url('persons/delete/'.$this->uri->segment(3, 0).'/'. $skill->prop_id.'/skills') ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="left" title="Delete">
				</a>
			</td>
			<td><?=$skill->skill?></td>
		</tr>
		<?php endforeach?>
		<?php endif ?>
	</table>
	<!-- add new skill link using a modal with a dropdown -->
	<button class="btn btn-primary  view_detail" relid="<?=$this->session->userdata('person_id');?>">Add new
		skill</button>
	<a href="<?=site_url('persons')?>" class="btn btn-secondary">Close</a>
</div>


<!-- add new modal -->
<div id="show_modal_add" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3> Add skill</h3>
				<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i>
				</button>
			</div>
			<?=form_open('detail_skills/add/'.$this->uri->segment(3, 0));?>

			<div class="modal-body">
			
				<!-- dropdown with the existing sectors.sector-->
				<div><label>Skill: </label>
					<!-- <select class="form-control" id="skill_selection" name="skill_selection">
					</select> -->
					<input id="myInput" type="text" placeholder="Search.." autofocus>
					<p>
						<table id='myTable' class="table" cellpadding='10'>
							<tbody>

							</tbody>
						</table>
				</div>
				<div class="modal-footer">
				<button type="button" class="btn btn-danger" id="reset" data-dismiss="modal"><i class="fa fa-times"></i>
					Close</button>
				</div>
			</div>
			<?=form_close();?>
		</div>

	</div>
</div>



<!-- script for - add new - modal -->
<script type="text/javascript">
	$(document).ready(function () {
		$('.view_detail').click(function () {
			var id = $(this).attr('relid'); //get the attribute value
			var url = $(location).attr('href').split("/");
			var segment = url[6];
			$.ajax({
				url: "<?php echo base_url(); ?>persons/exclude_existing_items/"+segment,
				data: {
					id: id,
					id_name: 'skill_id',
					type: 'skill',
					table: 'skills'
				},
				type: "post",
				dataType: 'json',
				success: function (response) {
					$.each(response, function (i) {
						$('#myTable').append(
							'<tr><td><a href="<?= base_url(); ?>detail_skills/add_skill/' +
							response[i].skill_id + '/<?= $this->uri->segment(3, 0) ?>">' + response[i].skill +
							'</a></td></tr>');

					});
					$('#show_modal_add').modal({
						backdrop: 'static',
						keyboard: true,
						show: true
					});
				}
			});
		});
	});
	//this puts the focus into the autofocus inside the modal
	$('.modal').on('shown.bs.modal', function () {
		$(this).find('[autofocus]').focus();
	});

//reset select data on cancel
	$(document).ready(function() {
    $("#reset").click(function() {
        $("#myInput").empty();
    });
});
</script>



<!-- filtering script -->
<script>
	$(document).ready(function () {
		$("#myInput").on("keyup", function () {
			var value = $(this).val().toLowerCase();
			$("#myTable tr").filter(function () {
				$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
			});
		});
	});

</script>



</div>
<?php include 'footer.php';?>
