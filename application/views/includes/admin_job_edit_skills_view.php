<!-- job requirements from job_requirements and skills tables -->

<br>
<div class="container">
	<div class="card">
		<div class="card-header">
			Skills
		</div>
		<div class="card-body">
			<?php if ($skills) : ?>
				<?php foreach ($skill_types as $type) : ?>
					<h3><?= $type == 'job_type' ? 'job type' : $type ?></h3>
					<?php foreach ($skills as $skill) : ?>
						<?php if ($skill['skill_type'] == $type) : ?>
							<span class="badge badge-primary"><?= $skill['skill'] ?>
								<a href=<?= base_url("admin_jobs/delete_skill/" . $job_id . "/" . $skill['skill_id']) ?> style="text-decoration:none">&nbsp;<i class="fa fa-minus"></i></a>&nbsp;
							</span>
						<?php endif ?>
					<?php endforeach ?>
				<?php endforeach ?>
			<?php endif ?>
		</div>
	</div>
</div>


<!-- add, remove -->
<div class="row">
	<!-- add new skill link using a modal with a dropdown -->
	<button class="btn btn-primary  view_detail" relid="<?= $job_id; ?>">Add new skill</button>
	<a href="<?= base_url('admin_jobs') ?>" class="btn btn-secondary">Close</a>

</div>
</div>

<!-- *** skills modal ***  -->
<!-- add new modal for skills -->
<div id="show_modal_add" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3> Add skill</h3>
				<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i>
				</button>
			</div>
			<?= form_open('admin_jobs/add_skill/' . $this->uri->segment(3, 0)); ?>

			<div class="modal-body">

				<div><label>Skill: </label>
					<input id="myInput" type="text" placeholder="Search.." autofocus required>
					<p>
						<table id='myTable' class="table" cellpadding='10'>
							<tbody>

							</tbody>
						</table>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" id="reset" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
				</div>
			</div>
			<?= form_close(); ?>
		</div>

	</div>
</div>



<!-- script for - add new skill  - modal -->
<script type="text/javascript">
	$(document).ready(function() {
		$('.view_detail').click(function() {
			var id = $(this).attr('relid'); //get the attribute value
			var segment = window.location.pathname.substring(window.location.pathname.lastIndexOf('/') +
				1);
			$.ajax({
				url: "<?php echo base_url(); ?>admin_jobs/exclude_existing_items/" + segment,
				data: {
					id: id,
					id_name: 'skill_id',
					type: 'skill',
					table: 'skills'
				},
				type: "post",
				dataType: 'json',
				success: function(response) {
					$.each(response, function(i) {
						$('#myTable').append(
							'<tr><td><a href="<?= base_url(); ?>admin_jobs/add_skill/' +
							response[i].skill_id +
							'/<?= $this->uri->segment(3, 0) ?>">' + response[i]
							.skill +
							'</a></td></tr>');

					});
					$('#show_modal_add').modal({
						backdrop: 'static',
						keyboard: true,
						show: true
					});
				}
			});
		});
	});
	//this puts the focus into the autofocus inside the modal
	$('.modal').on('shown.bs.modal', function() {
		$(this).find('[autofocus]').focus();
	});

	//reset select data on cancel
	$(document).ready(function() {
		$("#reset").click(function() {
			$("#myInput").empty();
		});
	});
</script>

<!-- filtering script -->
<script>
	$(document).ready(function() {
		$("#myInput").on("keyup", function() {
			var value = $(this).val().toLowerCase();
			$("#myTable tr").filter(function() {
				$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
			});
		});
	});
</script>


<!-- *** drvers license modal ***  -->
<!-- modal -->
<div id="show_modal" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3> Add drivers' license</h3>
			</div>
			<?= form_open('admin_jobs/add_license/' . $this->uri->segment(3, 0)); ?>

			<div class="modal-body">

				<!-- dropdown with the existing drivers.drivers_license-->
				<div><label for="license_select">drivers license type:</label>
					<select class="form-control" id="license_select" name="license_selection">
					</select>
					<label for="driving_years">Years of experience: </label>
					<input type="text" class="form-control" name="driving_years">
				</div>
				<!-- later we can add 95 and other such stuff if we need to  -->
				<!-- input field with the years of experience between 1 and 80 years -->

				<div class="modal-footer">
					<button type="submit" class="btn btn-success">Save changes</button>
					<button type="button" class="btn btn-danger" id="reset_license" data-dismiss="modal"><i class="fa fa-times"></i>
						Close</button>
				</div>
			</div>
			<?= form_close(); ?>
		</div>

	</div>
</div>



<!-- script for modal license -->
<script type="text/javascript">
	$(document).ready(function() {
		$('.view_detail_license').click(function() {
			var id = $(this).attr('relid'); //get the attribute value
			//get the segment to decide the redirect url to detail or desire
			var segment = window.location.pathname.substring(window.location.pathname.lastIndexOf('/') +
				1);
			$.ajax({
				url: "<?php echo base_url(); ?>admin_jobs/exclude_existing_items_licenses/" +
					segment,
				data: {
					id: id,
					id_name: 'driving_id',
					type: 'drivers_license',
					table: 'drivers',
				},
				type: "post",
				dataType: 'json',
				success: function(response) {
					$.each(response, function(i) {
						$('#license_select').append('<option value="' + response[i]
							.driving_id + '"> ' + response[i]
							.drivers_license + '</option>'
						); //hold the response in id and show on popup
					});
					$('#show_modal').modal({
						backdrop: 'static',
						keyboard: true,
						show: true
					});
				}
			});
		});
	});


	//reset select data on cancel
	$(document).ready(function() {
		$("#reset_license").click(function() {
			$("#license_select").empty();
		});
	});
</script>