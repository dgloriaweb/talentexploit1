
<!-- entry points: job drivers licenses or person property licenses. Exit points accordingly. -->
<!-- if entry is job, then id is job_id. if entry is user, the id is $person_id -->
<?php $id = $this->uri->segment(3, 0); ?>
<!-- if nothing is in the url, then it's a user id -->
<?php (!$id) ? $id=$this->session->userdata('person_id') : $id ;?>
<!-- view type for jobs: admin_jobs -->
<!-- view type for person licenses: persons -->
<?php $controller = $this->uri->segment(1,0);?>
<!-- check if the url is root or sub -->
<div class="container">
<?php if (isset($properties['drivers_licenses']) && $properties['drivers_licenses'][0]['drivers_license'] != 'none') : ?>
    <table class="table table-default">
        <tr class="table-primary">
            <th></th>
            <th>Type:</th>
            <th>Experience in years:</th>
        </tr>

        <?php if (isset($properties['drivers_licenses'])) : ?>
            <?php foreach ($properties['drivers_licenses'] as $drivers_license) : ?>
                <tr class="table-primary">
                    <td>
					<!-- define $driving_id according to entry points  -->
                        <a href="<?= base_url('drivers/submit_deleted_drivers_license/' .$controller.'/'. $id .'/'.$drivers_license['driving_id']) ?>">
                            <img src=<?= base_url("images/trash_s.png") ?> class="beaicons" data-toggle="tooltip" data-placement="left" title="Delete">
                        </a>
                    </td>
                    <td><?= $drivers_license['drivers_license'] ?></td>
                    <?php if ($drivers_license['drivers_license'] != 'none') : ?>
                        <td>
                            <?= $drivers_license['driving_years'] ?>
                        </td>
                    <?php endif ?>

                </tr>
            <?php endforeach ?>
        <?php endif ?>

    <?php else : ?>
        none
        <br>
    <?php endif ?>
    </table>
    <!-- add new license link using a modal with a dropdown -->
	<button class="btn btn-primary  view_detail_l" relid="<?= $this->session->userdata('person_id');  ?>">Add new
		license</button>
	<a href="<?= site_url('persons') ?>" class="btn btn-secondary">Close</a>
</div>
<br>
<!-- modal -->
<div id="show_modal" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3> Add drivers' license</h3>
			</div>
			<?= form_open('drivers/submit_added_drivers_license/'.$controller.'/'.$id) ;?>

			<div class="modal-body">

				<!-- dropdown with the existing drivers.drivers_license-->
				<div><label for="license_select">drivers license type</label>
					<select class="form-control" id="license_select" name="license_selection">
					</select>
				</div>
				<!-- later we can add 95 and other such stuff if we need to  -->
				<!-- input field with the years of experience between 1 and 80 years -->
				<div><label for="driving_years">Experience in years</label>
					<input class="form-control" type="text" name="driving_years" />
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-success">Save changes</button>
					<button type="button" class="btn btn-danger"  id="reset" data-dismiss="modal"><i class="fa fa-times"></i>
						Close</button>
				</div>
			</div>
			<?= form_close() ;?>
		</div>

	</div>
</div>



<!-- script for modal -->
<script type="text/javascript">
	$(document).ready(function () {
		$('.view_detail_l').click(function () {
			var id = $(this).attr('relid'); //get the attribute value
			//get the segment to decide the redirect url to detail or desire
			var segment = window.location.pathname.substring(window.location.pathname.lastIndexOf('/') + 1);
			$.ajax({
				url: "<?php echo base_url(); ?>persons/exclude_existing_items/"+segment,
				data: {
					id: id,
					id_name: 'driving_id',
                    type: 'drivers_license',
                    table: 'drivers',
				},
				type: "post",
				dataType: 'json',
				success: function (response) {
					$.each(response, function (i) {
						$('#license_select').append('<option value="' + response[i]
							.driving_id + '"> ' + response[i]
							.drivers_license + '</option>'
							); //hold the response in id and show on popup
					});
					$('#show_modal').modal({
						backdrop: 'static',
						keyboard: true,
						show: true
					});
				}
			});
		});
	});


//reset select data on cancel
$(document).ready(function() {
    $("#reset").click(function() {
        $("#license_select").empty();
    });
});
</script>
