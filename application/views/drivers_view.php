<?php include 'header.php';?>
<?= validation_errors(); ?>

<h1>Drivers' licenses</h1>
<div class="col-md-6">
	<table class="table table-primary">
		<tr>
			<th></th>
			<th>Drivers' license category</th>
			<th>
			<?php if ($person_licenses[0]->drivers_license_type != 'none') :?>
				Experience in years
				<?php endif?>

			</th>
		</tr>
		<?php if($person_licenses) : ?>
		<?php foreach ($person_licenses as $person_license): ?>
		<tr>
			<td><a href="<?=base_url('persons/delete/'. $person_license->prop_id.'/drivers_license') ?>" class="badge badge-secondary"><i class="fa fa-trash"></i></a></td>
			<td><?=$person_license->drivers_license_type?></td>
			<td>
			<?php if ($person_license->drivers_license_type != 'none') :?>
				<?=$person_license->driving_years?>
				<?php endif?>
			</td>
		</tr>
		<?php endforeach?>
			<?php endif ?>
	</table>

	<!-- add new license link using a modal with a dropdown -->
	<button class="btn btn-primary  view_detail" relid="<?= $this->session->userdata('person_id');  ?>">Add new license</button>
	<a href="<?= site_url('persons') ?>" class="btn btn-secondary">Close</a>
</div>

<!-- modal -->
<div id="show_modal" class="modal fade" role="dialog" >
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3> Add drivers' license</h3>
			</div>
			<?= form_open('drivers/add') ;?>

			<div class="modal-body">

				<!-- dropdown with the existing drivers.drivers_license_type-->
				<div><label for="license_select">drivers license type</label>
				<select class="form-control" id="license_select" name="license_selection">
				</select>
				</div>
				<!-- later we can add 95 and other such stuff if we need to  -->
				<!-- input field with the years of experience between 1 and 80 years -->
				<div><label for="driving_years">Experience in years</label>
				<input class="form-control" type="text" name="driving_years" />
				</div>
			<div class="modal-footer">
				<button type="submit" class="btn btn-success">Save changes</button>
				<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
			</div>
			</div>
			<?= form_close() ;?>
		</div>

	</div>
</div>



<!-- script for modal -->
<script type="text/javascript">
	$(document).ready(function () {
		$('.view_detail').click(function () {
			var id = $(this).attr('relid'); //get the attribute value
			$.ajax({
				url: "<?php echo base_url(); ?>drivers/exclude_existing_items",
				data: {
					id: id
				},
				type: "post",
				dataType: 'json',
				success: function (response) {
					$.each(response, function (i) {
						$('#license_select').append('<option value="'+response[i].driving_id+'"> ' + response[i].drivers_license_type + '</option>'); //hold the response in id and show on popup
					});
					$('#show_modal').modal({
						backdrop: 'static',
						keyboard: true,
						show: true
					});
				}
			});
		});
	});

</script>

</div>
</body>

</html>
