<?php include 'header.php'; ?>
<?php if (!$this->session->userdata('logged_in')) : ?>
	<?= validation_errors(); ?>

	Welcome. You are not logged in.<br />

	<!-- here we need to check if user is logged in -->
<?php else : ?>

	<?php $job_id = $job['job_id'] ?>
	<?php $person_id = $this->session->userdata('person_id'); ?>
	<br>
	<h1>
		<?= $job['job_name'] ?> match: <?= $job['job_rate'] ?>%
	</h1>


	<!-- ***********************************************************  -->
	<!-- *** work preferences *** -->
	<!-- ***********************************************************  -->
	<h3>Work hour and day requirements</h3>
	<div class="container">
		<div class="row">
			<?php foreach ($workprefs_array as $type => $value) : ?>
				<div class="col-12 col-md-3 workprefs">
					<h5><?= $type ?></h5>
					<ul class="list-group">
						<?php foreach ($workprefs_array[$type] as $value) : ?>
							<?php if ($job[$value] == 1) : ?>
								<?php if ($job[$value] == $work_details[$value]) : ?>
									<li class="list-group-item"><?= $value ?>
										<img src=<?= base_url("/images/confirm_b_s.png") ?> class="beaicons" data-toggle="tooltip" data-placement="right" title="Match">
									</li>
								<?php else : ?>
									<li class="list-group-item"><?= $value ?>
										<img src=<?= base_url("/images/cancel_o_s.png") ?> class="beaicons" data-toggle="tooltip" data-placement="right" title="No match">
									</li>
								<?php endif ?>
							<?php else : ?>
								<?php if ($type == 'overtime') : ?>
									<li class="list-group-item">Not Required</li>
								<?php endif ?>

							<?php endif ?>
						<?php endforeach ?>
					</ul>
				</div>

			<?php endforeach ?>

		</div>
		<!-- work preferences dropdown -->
		<div class="accordion" id="myAccordion">
			<div class="row">
				<a class="btn btn-outline-info" data-toggle="collapse" href="#collapseExample" role="button" data-parent="#myAccordion" aria-expanded="false" aria-controls="collapseExample">
					Edit your overtime and work hour preferences <i class="fa fa-caret-down"></i>
				</a>
			</div>
			<div class="row">
				<div class="collapse" id="collapseExample">
					<div class="card card-body">
						<?php include 'includes/edit_workprefs_view.php'; ?>
					</div>
				</div>
			</div>
			<br>
			<hr>
			<br>
		</div>
	</div>

	<!-- ***********************************************************  -->
	<!-- *** END work preferences *** -->
	<!-- ***********************************************************  -->

	<!-- ***********************************************************  -->
	<!-- *** drivers licenses *** -->
	<!-- ***********************************************************  -->
	<h3>Drivers' Licenses</h3>
	<div class="container">
		<div class="row">
			<div class="col col-md-6">
				<div class="card border-primary mb-6" style="max-width: 40rem;">
					<div class="card-header">
						Matching
					</div>
					<div class="card-body">
						<?php if ($job['matching_licenses_array']) : ?>
							<?php foreach ($job['matching_licenses_array'] as $license) : ?>
								<div class="row">
									<div class="col col-md-9">
										Type: <?= $license['drivers_license'] ?>
										<?php if ($license['drivers_license'] != 'none') : ?>
											Years required: <?= $license['years'] ?>
										<?php endif ?>
									</div>
									<div class="col col-md-3">
										<?php if ($license['drivers_license'] != 'none') : ?>
											<a href=<?= base_url("job_user/delete_license/" . $job_id . "/" . $license['driving_id']) ?> class="btn btn-info">remove</a> </p>
										<?php endif ?>
									</div>
								</div>
							<?php endforeach ?>
						<?php endif ?>
					</div>
				</div>
			</div>

			<div class="col col-md-6">
				<div class="card border-primary mb-6" style="max-width: 40rem;">
					<div class="card-header">
						Missing
					</div>
					<div class="card-body">
						<?php if ($job['mismatching_licenses_array'] && $job['mismatching_licenses_array'] != 1) : ?>
							<?php foreach ($job['mismatching_licenses_array'] as $license) : ?>
								<div class="row">
									<div class="col col-md-10">
										<h5 class="card-title">Type: <?= $license['drivers_license'] ?></h5>
										Years required: <?= $license['years'] ?>
									</div>
									<div class="col col-md-2">
										<a href=<?= base_url("job_user/add_license/" . $job_id . "/" . $license['driving_id'] . "/" . $license['years']) ?> class="btn btn-info">add</a></p>
									</div>
								</div>
							<?php endforeach ?>
						<?php endif ?>
					</div>
				</div>
			</div>
		</div>
		<div class="accordion" id="myAccordion">
			<div class="row">
				<a class="btn btn-outline-info" data-toggle="collapse" href="#collapseExample2" role="button" data-parent="#myAccordion" aria-expanded="false" aria-controls="collapseExample2">
					Edit your drivers' licenses <i class="fa fa-caret-down"></i>
				</a>
			</div>
			<div class="row">
				<div class="collapse" id="collapseExample2">
					<div class="card card-body">

						<?php //include 'includes/edit_licenses_view.php'; 
						?>
						<table class="table table-primary">
							<tr>
								<th></th>
								<th>Drivers' license category</th>
								<th>
									<?php if (isset($properties['drivers_license']) && $properties['drivers_license'][0]['drivers_license'] != 'none') : ?>
										Experience in years
									<?php endif ?>

								</th>
							</tr>
							<?php if (isset($properties['drivers_license'])) : ?>
								<?php foreach ($properties['drivers_license'] as $drivers_license) : ?>
									<tr>
										<td>
											<a href="<?= base_url('persons/delete/' . $person_id . '/' . $drivers_license['prop_id'] . '/drivers_license') ?>">
												<img src=<?= base_url("images/trash_s.png") ?> class="beaicons" data-toggle="tooltip" data-placement="left" title="Delete">
											</a>
										</td>
										<td><?= $drivers_license['drivers_license'] ?></td>
										<td>
											<?php if ($drivers_license['drivers_license'] != 'none') : ?>
												<?= $drivers_license['driving_years'] ?>
											<?php endif ?>
										</td>
									</tr>

								<?php endforeach ?>
							<?php endif ?>
						</table>

					</div>
				</div>
			</div>
			<br>
			<hr>
			<br>
		</div>
	</div>
	<!-- ***********************************************************  -->
	<!-- *** END drivers licenses *** -->
	<!-- ***********************************************************  -->



	<!-- ***********************************************************  -->
	<!-- *** skills *** -->
	<!-- ***********************************************************  -->

	<h3>Skills</h3>
	<div class="container">
		<div class="card">
			<div class="card-header">
				Matching
			</div>
			<div class="card-body">
				<?php if ($job['matching_skills_array']) : ?>
					<?php foreach ($skill_types as $type) : ?>
						<h3><?= $type ?></h3>
						<?php foreach ($job['matching_skills_array'] as $skill) : ?>
							<?php if ($skill['skill_type'] == $type) : ?>
								<span class="badge badge-primary"><?= $skill['skill'] ?>
									<a href=<?= base_url("job_user/delete_skill/" . $job_id . "/" . $skill['skill_id']) ?>><i class="fa fa-minus"></i></a>&nbsp;
								</span>
							<?php endif ?>
						<?php endforeach ?>
					<?php endforeach ?>
				<?php endif ?>
			</div>
		</div>
		<br>
		<div class="card">
			<div class="card-header">
				Missing
			</div>
			<div class="card-body">

				<?php if ($job['mismatching_skills_array']) : ?>
					<?php foreach ($job['mismatching_skills_array'] as $skill) : ?>
						<span class="badge badge-primary"><?= $skill['skill'] ?>
							<a href=<?= base_url("job_user/add_skill/" . $job_id . "/" . $skill['skill_id']) ?>><i class="fa fa-plus"></i></a>&nbsp;
						</span>
					<?php endforeach ?>
				<?php endif ?>
			</div>
		</div>
	</div>

	<!-- ***********************************************************  -->
	<!-- *** END skills *** -->
	<!-- ***********************************************************  -->




<?php endif ?>
<?php include 'footer.php'; ?>