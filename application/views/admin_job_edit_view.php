<?php include 'header.php';?>
<?php if (!$this->session->userdata('logged_in')): ?>

Welcome. You are not logged in.<br />

<!-- here we need to check if user is logged in -->
<?php else: ?>
<?php $job_id = $this->uri->segment(3, 0); ?>
<h1>
	<p style="text-transform: capitalize;">Job: <?= $job_data[0]->job_name?></p>
</h1>
<br>
<div class="row">
	<a href="<?= site_url('admin_jobs') ?>" class="btn btn-secondary">Close</a>
</div>

<h2>Work preferences required in this position</h2>
<!-- checkboxes from jobs table -->
<?=form_open("admin_jobs/update_job_preferences/". $job_data[0]->job_id); ?>

<div class="row">
	<div class="form-group col-lg-6">
		<div class="bs-component">
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkRemote" name="chkRemote"
					<?php if($job_data[0]->remote == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkRemote">Remote work</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkOvertime" name="chkOvertime"
					<?php if($job_data[0]->overtime == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkOvertime">Overtime work</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkNightshift" name="chkNightshift"
					<?php if($job_data[0]->nightshift == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkNightshift">Night shift</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkOthershift" name="chkOthershift"
					<?php if($job_data[0]->other_shift == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkOthershift">Other shift</label>
			</div>
		</div>
	</div>
	<div class="form-group col-lg-6 ">
		<div class="bs-component">

			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkWeekday" name="chkWeekday"
					<?php if($job_data[0]->weekdays == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkWeekday">Weekday (normal) work</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkSaturday" name="chkSaturday"
					<?php if($job_data[0]->saturday == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkSaturday">Saturday work</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkSunday" name="chkSunday"
					<?php if($job_data[0]->sunday == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkSunday">Sunday work</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkBankholidays" name="chkBankholidays"
					<?php if($job_data[0]->bank_holidays == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkBankholidays">Bank holidays work</label>
			</div>
		</div>
	</div>
</div>
<!-- save  -->
<div class="row">
	<button class="btn btn-warning">Save changes</button>

</div>
<?=form_close();?>
<br>
<!-- keywords from jobs table -->
<h2>Keywords</h2>
<?=form_open("admin_jobs/update_job_keywords/". $job_id); ?>

<?php $keywords = explode(',',$job_data[0]->keywords) ?>
<?php foreach($keywords as $keyword) : ?>
<div class="row">
	<h5><?= $keyword ?></h5>
</div>
<?php endforeach;?>
<!-- add, remove -->
<div class="row">
	<div class="card">
		Add new keyword &nbsp;<input type="text" name="keyword_add">
	</div>
</div>
<!-- save -->
<div class="row">
	<button class="btn btn-warning">Save changes</button>
</div>
<?=form_close();?>
<br>
<!-- similar jobs from jobs table -->
<h2>Similar jobs</h2>
<?=form_open("admin_jobs/update_similar_jobs/". $job_id); ?>


<?php foreach($similar_jobs as $similar_job) : ?>
<div class="row">
	<a href="<?= site_url('admin_jobs/remove_similar_job/'.$job_id.'/'.$similar_job->job_id) ?>">
		<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip" data-placement="right"
			title="Delete">
	</a>
	<h5><?= $similar_job->job_name ?></h5>
</div>
<?php endforeach;?>
<!-- add, remove -->
<div class="row">
	<div class="card">
		Add new similar_job &nbsp;

		<!-- add select dropdown -->
		<select name="similar_job_select">

			<?php foreach($filtered_jobs as $job) : ?>
			<!-- remove current job from list -->
			<option value="<?=  $job->job_id ?>"><?= $job->job_name?>
			</option>
			<?php endforeach ?>
		</select>
	</div>
</div>

<!-- save -->
<div class="row">
	<button class="btn btn-warning">Save changes</button>
</div>
<?=form_close();?>
<br>
<!-- job requirements from job_requirements and skills tables -->
<h2>Job requirements</h2>
<br>
<div class="row">
	<div class="col">
		<br>
		<h3>Drivers' Licenses</h3>
		<?php foreach ($drivers_licenses as $drivers_license) :?>
		<div class="row">
			<div class="col details-grid">
				<a
					href="<?= site_url('admin_jobs/remove_drivers_license/'.$job_id.'/'.$drivers_license->job_license_id) ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="right" title="Delete">
				</a>
				<?= $drivers_license->drivers_license ?>
			</div>
		</div>
		<?php endforeach ?>
	</div>
</div>

<div class="row">
<button class="btn btn-primary  view_detail_license" relid="<?= $job_id;?>">Add new drivers' license</button>
	<a href="<?= site_url('admin_jobs') ?>" class="btn btn-secondary">Close</a>
</div>
<div class="row">
	<div class="col">
		<br>
		<h3>Personality</h3>
		<?php foreach ($skills as $skill) :?>
		<?php if($skill->skill_type =='personality') :?>
		<div class="row">
			<div class="col details-grid">
				<a href="<?= site_url('admin_jobs/remove_skill/'.$job_id.'/'.$skill->skill_id) ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="right" title="Delete">
				</a>
				<?= $skill->skill ?>
			</div>
		</div>
		<?php endif ?>
		<?php endforeach ?>
	</div>
</div>
<div class="row">
	<div class="col">
		<br>

		<h3>Certification</h3>
		<?php foreach ($skills as $skill) :?>
		<?php if($skill->skill_type =='certificate') :?>
		<div class="row">
			<div class="col details-grid">
				<a href="<?= site_url('admin_jobs/remove_skill/'.$job_id.'/'.$skill->skill_id) ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="right" title="Delete">
				</a>
				<?= $skill->skill ?>
			</div>
		</div>
		<?php endif ?>
		<?php endforeach ?>
	</div>
</div>
<div class="row">
	<div class="col">
		<br>

		<h3>Resources</h3>
		<?php foreach ($skills as $skill) :?>
		<?php if($skill->skill_type =='resources') :?>
		<div class="row">
			<div class="col details-grid">
				<a href="<?= site_url('admin_jobs/remove_skill/'.$job_id.'/'.$skill->skill_id) ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="right" title="Delete">
				</a>
				<?= $skill->skill ?>
			</div>
		</div>
		<?php endif ?>
		<?php endforeach ?>
	</div>
</div>
<div class="row">
	<div class="col">
		<br>

		<h3>Skills</h3>
		<?php foreach ($skills as $skill) :?>
		<?php if($skill->skill_type =='job_type') :?>
		<div class="row">
			<div class="col details-grid">
				<a href="<?= site_url('admin_jobs/remove_skill/'.$job_id.'/'.$skill->skill_id) ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="right" title="Delete">
				</a>
				<?= $skill->skill ?>
			</div>
		</div>
		<?php endif ?>
		<?php endforeach ?>
	</div>
</div>
<!-- add, remove -->
<div class="row">
	<!-- add new skill link using a modal with a dropdown -->
	<button class="btn btn-primary  view_detail" relid="<?=$job_id;?>">Add new skill</button>
	<a href="<?= site_url('admin_jobs') ?>" class="btn btn-secondary">Close</a>

</div>
<?php endif;?>


<!-- *** skills modal ***  -->
<!-- add new modal for skills -->
<div id="show_modal_add" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3> Add skill</h3>
				<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i>
				</button>
			</div>
			<?=form_open('admin_jobs/add_skill/'.$this->uri->segment(3, 0));?>

			<div class="modal-body">

				<div><label>Skill: </label>
					<input id="myInput" type="text" placeholder="Search.." autofocus>
					<p>
						<table id='myTable' class="table" cellpadding='10'>
							<tbody>

							</tbody>
						</table>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" id="reset" data-dismiss="modal"><i
							class="fa fa-times"></i> Close</button>
				</div>
			</div>
			<?=form_close();?>
		</div>

	</div>
</div>



<!-- script for - add new skill  - modal -->
<script type="text/javascript">
	$(document).ready(function () {
		$('.view_detail').click(function () {
			var id = $(this).attr('relid'); //get the attribute value
			var url = $(location).attr('href').split("/");
			var segment = url[6];
			$.ajax({
				url: "<?php echo base_url(); ?>admin_jobs/exclude_existing_items/" + segment,
				data: {
					id: id,
					id_name: 'skill_id',
					type: 'skill',
					table: 'skills'
				},
				type: "post",
				dataType: 'json',
				success: function (response) {
					$.each(response, function (i) {
						$('#myTable').append(
							'<tr><td><a href="<?= base_url(); ?>admin_jobs/add_skill/' +
							response[i].skill_id +
							'/<?= $this->uri->segment(3, 0) ?>">' + response[i]
							.skill +
							'</a></td></tr>');

					});
					$('#show_modal_add').modal({
						backdrop: 'static',
						keyboard: true,
						show: true
					});
				}
			});
		});
	});
	//this puts the focus into the autofocus inside the modal
	$('.modal').on('shown.bs.modal', function () {
		$(this).find('[autofocus]').focus();
	});

	//reset select data on cancel
	$(document).ready(function () {
		$("#reset").click(function () {
			$("#myInput").empty();
		});
	});

</script>

<!-- filtering script -->
<script>
	$(document).ready(function () {
		$("#myInput").on("keyup", function () {
			var value = $(this).val().toLowerCase();
			$("#myTable tr").filter(function () {
				$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
			});
		});
	});

</script>


<!-- *** drvers license modal ***  -->
<!-- modal -->
<div id="show_modal" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3> Add drivers' license</h3>
			</div>
			<?= form_open('admin_jobs/add_license/'.$this->uri->segment(3, 0)) ;?>

			<div class="modal-body">

				<!-- dropdown with the existing drivers.drivers_license-->
				<div><label for="license_select">drivers license type</label>
					<select class="form-control" id="license_select" name="license_selection">
					</select>
				</div>
				<!-- later we can add 95 and other such stuff if we need to  -->
				<!-- input field with the years of experience between 1 and 80 years -->
				
				<div class="modal-footer">
					<button type="submit" class="btn btn-success">Save changes</button>
					<button type="button" class="btn btn-danger"  id="reset_license" data-dismiss="modal"><i class="fa fa-times"></i>
						Close</button>
				</div>
			</div>
			<?= form_close() ;?>
		</div>

	</div>
</div>



<!-- script for modal license -->
<script type="text/javascript">
	$(document).ready(function () {
		$('.view_detail_license').click(function () {
			var id = $(this).attr('relid'); //get the attribute value
			//get the segment to decide the redirect url to detail or desire
			var url = $(location).attr('href').split("/");
			var segment = url[6];
			$.ajax({
				url: "<?php echo base_url(); ?>admin_jobs/exclude_existing_items_licenses/"+segment,
				data: {
					id: id,
					id_name: 'driving_id',
                    type: 'drivers_license',
                    table: 'drivers',
				},
				type: "post",
				dataType: 'json',
				success: function (response) {
					$.each(response, function (i) {
						$('#license_select').append('<option value="' + response[i]
							.driving_id + '"> ' + response[i]
							.drivers_license + '</option>'
							); //hold the response in id and show on popup
					});
					$('#show_modal').modal({
						backdrop: 'static',
						keyboard: true,
						show: true
					});
				}
			});
		});
	});


//reset select data on cancel
$(document).ready(function() {
    $("#reset_license").click(function() {
        $("#license_select").empty();
    });
});
</script>

</div>
<?php include 'footer.php';?>
