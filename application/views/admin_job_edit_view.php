<?php include 'header.php';?>
<?php if (!$this->session->userdata('logged_in')): ?>

Welcome. You are not logged in.<br />

<!-- here we need to check if user is logged in -->
<?php else: ?>
	<?php $job_id = $this->uri->segment(3, 0); ?>
<h1>
	<p style="text-transform: capitalize;">Job: <?= $job_data[0]->job_name?></p>
</h1>
<br>

<h2>Work preferences required in this position</h2>
<!-- checkboxes from jobs table -->
<?=form_open("admin_jobs/update_job_preferences/". $job_data[0]->job_id); ?>

<div class="row">
	<div class="form-group col-lg-6">
		<div class="bs-component">
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkRemote" name="chkRemote"
					<?php if($job_data[0]->remote == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkRemote">Remote work</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkOvertime" name="chkOvertime"
					<?php if($job_data[0]->overtime == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkOvertime">Overtime work</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkNightshift" name="chkNightshift"
					<?php if($job_data[0]->nightshift == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkNightshift">Night shift</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkOthershift" name="chkOthershift"
					<?php if($job_data[0]->other_shift == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkOthershift">Other shift</label>
			</div>
		</div>
	</div>
	<div class="form-group col-lg-6 ">
		<div class="bs-component">

			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkWeekday" name="chkWeekday"
					<?php if($job_data[0]->weekdays == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkWeekday">Weekday (normal) work</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkSaturday" name="chkSaturday"
					<?php if($job_data[0]->saturday == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkSaturday">Saturday work</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkSunday" name="chkSunday"
					<?php if($job_data[0]->sunday == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkSunday">Sunday work</label>
			</div>
			<div class="custom-control custom-checkbox">
				<input type="checkbox" class="custom-control-input" id="chkBankholidays" name="chkBankholidays"
					<?php if($job_data[0]->bank_holidays == 1) : echo 'checked'; endif;?>>
				<label class="custom-control-label" for="chkBankholidays">Bank holidays work</label>
			</div>
		</div>
	</div>
</div>
<!-- save  -->
<div class="row">
	<button class="btn btn-warning">Save changes</button>

</div>
<?=form_close();?>
<br>
<!-- keywords from jobs table -->
<h2>Keywords</h2>
<?=form_open("admin_jobs/update_job_keywords/". $job_id); ?>

<?php $keywords = explode(',',$job_data[0]->keywords) ?>
<?php foreach($keywords as $keyword) : ?>
<div class="row">
	<h5><?= $keyword ?></h5>
</div>
<?php endforeach;?>
<!-- add, remove -->
<div class="row">
	Add new keyword &nbsp;<input type="text" name="keyword_add">
</div>
<!-- save -->
<div class="row">
	<button class="btn btn-warning">Save changes</button>
</div>
<?=form_close();?>
<br>
<!-- similar jobs from jobs table -->
<h2>Similar jobs</h2>
<?=form_open("admin_jobs/update_similar_jobs/". $job_id); ?>


<?php foreach($similar_jobs as $similar_job) : ?>
<div class="row">
	<a href="<?= site_url('admin_jobs/remove_similar_job/'.$job_id.'/'.$similar_job->job_id) ?>">
		<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip" data-placement="right"
			title="Delete">
	</a>
	<h5><?= $similar_job->job_name ?></h5>
</div>
<?php endforeach;?>
<!-- add, remove -->
<div class="row">
	Add new similar_job &nbsp;

	<!-- add select dropdown -->
	<select name="similar_job_select">

		<?php foreach($filtered_jobs as $job) : ?>
		<!-- remove current job from list -->
		<option value="<?=  $job->job_id ?>"><?= $job->job_name?>
		</option>
		<?php endforeach ?>
	</select>
</div>

<!-- save -->
<div class="row">
	<button class="btn btn-warning">Save changes</button>
</div>
<?=form_close();?>
<br>
<!-- job requirements from job_requirements and skills tables -->
<h2>Job requirements</h2>
<br>
<div class="row">
	<div class="col">
		<br>
		<h3>Personality</h3>
		<?php foreach ($skills as $skill) :?>
		<?php if($skill->skill_type =='personality') :?>
		<div class="row">
			<div class="col details-grid">
				<a href="<?= site_url('admin_jobs/remove_skill/'.$job_id.'/'.$skill->skill_id) ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="right" title="Delete">
				</a>
				<?= $skill->skill ?>
			</div>
		</div>
		<?php endif ?>
		<?php endforeach ?>
	</div>
</div>
<div class="row">
	<div class="col">
		<br>

		<h3>Certification</h3>
		<?php foreach ($skills as $skill) :?>
		<?php if($skill->skill_type =='certificate') :?>
		<div class="row">
			<div class="col details-grid">
			<a href="<?= site_url('admin_jobs/remove_skill/'.$job_id.'/'.$skill->skill_id) ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="right" title="Delete">
				</a>
				<?= $skill->skill ?>
			</div>
		</div>
		<?php endif ?>
		<?php endforeach ?>
	</div>
</div>
<div class="row">
	<div class="col">
		<br>

		<h3>Resources</h3>
		<?php foreach ($skills as $skill) :?>
		<?php if($skill->skill_type =='resources') :?>
		<div class="row">
			<div class="col details-grid">
			<a href="<?= site_url('admin_jobs/remove_skill/'.$job_id.'/'.$skill->skill_id) ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="right" title="Delete">
				</a>
				<?= $skill->skill ?>
			</div>
		</div>
		<?php endif ?>
		<?php endforeach ?>
	</div>
</div>
<div class="row">
	<div class="col">
		<br>

		<h3>Skills</h3>
		<?php foreach ($skills as $skill) :?>
		<?php if($skill->skill_type =='job_type') :?>
		<div class="row">
			<div class="col details-grid">
			<a href="<?= site_url('admin_jobs/remove_skill/'.$job_id.'/'.$skill->skill_id) ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="right" title="Delete">
				</a>
				<?= $skill->skill ?>
			</div>
		</div>
		<?php endif ?>
		<?php endforeach ?>
	</div>
</div>
<div class="row">
<button class="btn btn-primary view_detail"  relid="<?= $job_id  ?>">Add skill</button>
</div>

<!-- add, remove -->
<!-- save -->
<!-- cancel -->
<div class="row">
	<a href="<?= site_url('admin_jobs') ?>" class="btn btn-secondary">Close</a>
</div>

<?php endif;?>

</div>
<?php include 'footer.php';?>

 
<!-- modal -->
<div id="show_modal" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3> Add skill</h3>
			</div>
			<?= form_open('admin_jobs/add_skill/'.$job_id) ;?>

			<div class="modal-body">

				<!-- dropdown with the skills-->
				<div><label for="skill_select">skill type</label>
					<select class="form-control" id="skill_select" name="skill_selection">
					</select>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-success">Save changes</button>
					<button type="button" class="btn btn-danger"  id="reset" data-dismiss="modal"><i class="fa fa-times"></i>
						Close</button>
				</div>
			</div>
			<?= form_close() ;?>
		</div>

	</div>
</div>



<!-- script for modal -->
<script type="text/javascript">
	$(document).ready(function () {
		$('.view_detail').click(function () {
			var id = $(this).attr('relid'); //get the attribute value
			//get the segment to decide the redirect url to detail or desire
			var url = $(location).attr('href').split("/");
			var segment = url[6];
			$.ajax({
				url: "<?php echo base_url(); ?>admin_jobs/exclude_existing_skills/"+segment,
				data: {
					id: id,
					id_name: 'skill_id',
                    type: 'skill',
                    table: 'skills',
				},
				type: "post",
				dataType: 'json',
				success: function (response) {
					$.each(response, function (i) {
						$('#skill_select').append('<option value="' + response[i]
							.skill_id + '"> ' + response[i]
							.skill + '</option>'
							); //hold the response in id and show on popup
					});
					$('#show_modal').modal({
						backdrop: 'static',
						keyboard: true,
						show: true
					});
				}
			});
		});
	});


//reset select data on cancel
$(document).ready(function() {
    $("#reset").click(function() {
        $("#skill_select").empty();
    });
});
</script>
