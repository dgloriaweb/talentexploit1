<?php include 'header.php';?>
<?=validation_errors();?>

<h1>Sectors</h1>
<div class="col-md-12">
	<table class="table table-primary">
		<tr>
			<th></th>
			<th>Sector</th>
			<th>Experience in years</th>
		</tr>
		<?php if ($sectors): ?>
		<?php foreach ($sectors as $sector): ?>
		<tr>
			<td>
				<a href="<?=base_url('persons/delete/'.$this->uri->segment(3, 0).'/' . $sector->prop_id . '/sectors') ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="left" title="Delete">
				</a>
				<a class="update_sector" relid_update="<?=$sector->prop_id?>">
					<img src=<?=base_url("images/edit_s2.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="left" title="Edit item">
				</a>
			</td>
			<td><?=$sector->sector?></td>
			<td><?=$sector->sector_years?></td>
		</tr>
		<?php endforeach?>
		<?php endif?>
	</table>

	<!-- add new license link using a modal with a dropdown -->
	<button class="btn btn-primary  view_detail" relid="<?=$this->session->userdata('person_id');?>">Add new
		sector</button>
	<a href="<?=base_url('persons')?>" class="btn btn-secondary">Close</a>
</div>

<!-- add new modal -->
<div id="show_modal_add" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3> Add sector</h3>
			</div>
			<?=form_open('detail_sectors/add/'.$this->uri->segment(3, 0)) ;?>

			<div class="modal-body">

				<!-- dropdown with the existing sectors.sector-->
				<div><label for="sector_selection">sector</label>
					<select class="form-control" id="sector_selection" name="sector_selection">
					</select>
				</div>
				<!-- input field with the years of experience between 1 and 80 years -->
				<div><label for="sector_years">Experience in years</label>
					<input class="form-control" type="text" name="sector_years" />
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-success">Save changes</button>
					<button type="button" class="btn btn-danger" id="reset" data-dismiss="modal"><i class="fa fa-times"></i>
						Close</button>
				</div>
			</div>
			<?=form_close();?>
		</div>

	</div>
</div>


<!-- update modal -->
<div id="show_modal_update" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3> Update sector</h3>
			</div>
			<!-- add prop_id of this row -->
			<?=form_open('detail_sectors/edit/'.$this->uri->segment(3, 0)) ;?>

			<div class="modal-body">

				<!-- input field with the years of experience between 1 and 80 years -->
				<div><label for="sector_years">Experience in years</label>
					<input class="form-control" type="text" id="sector_years_update" name="sector_years_update" />
					<input type="hidden" id="prop_id" name="prop_id" />
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-success">Save changes</button>
					<button type="button" class="btn btn-danger" id="reset" data-dismiss="modal"><i class="fa fa-times"></i>
						Close</button>
				</div>
			</div>
			<?=form_close();?>
		</div>

	</div>
</div>


<!-- script for - add new - modal -->
<script type="text/javascript">
	$(document).ready(function () {
		$('.view_detail').click(function () {
			var id = $(this).attr('relid'); //get the attribute value
			//get the segment to decide the redirect url to detail or desire
			var segment = window.location.pathname.substring(window.location.pathname.lastIndexOf('/') + 1);
			$.ajax({
				url: "<?php echo base_url(); ?>persons/exclude_existing_items/"+segment,
				data: {
					id: id,
					id_name: 'sector_id',
                    type: 'sector',
                    table: 'sectors'
				},
				type: "post",
				dataType: 'json',
				success: function (response) {
					$.each(response, function (i) {
						$('#sector_selection').append('<option value="' + response[i]
							.sector_id + '"> ' + response[i].sector + '</option>'
						); //hold the response in id and show on popup
					});
					$('#show_modal_add').modal({
						backdrop: 'static',
						keyboard: true,
						show: true
					});
				}
			});
		});
	});

</script>


<!-- script for - update - modal -->
<script type="text/javascript">
	$(document).ready(function () {
		$('.update_sector').click(function () {
			var id = $(this).attr('relid_update'); //get the attribute value
			var segment = window.location.pathname.substring(window.location.pathname.lastIndexOf('/') + 1);
			$.ajax({
				url: "<?php echo base_url(); ?>detail_sectors/get_years/"+segment,
				data: {
					id: id
				},
				type: "post",
				dataType: 'json',
				success: function (response) {
					$('#sector_years_update').val(response.sector_years);
					$('#prop_id').val(response.prop_id);
					$('#show_modal_update').modal({
						backdrop: 'static',
						keyboard: true,
						show: true
					});
				}
			});
		});
	});


//reset select data on cancel
$(document).ready(function() {
    $("#reset").click(function() {
        $("#sector_selection").empty();
    });
});
</script>

</div>
<?php include 'footer.php';?>
