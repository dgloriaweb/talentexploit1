<?php include 'header.php';?>
<?= validation_errors(); ?>
<h1>Citizenships</h1>
<div class="col-md-6">
	<table class="table table-primary">
		<tr>
			<th></th>
			<th>Citizenship</th>

		</tr>
		<?php foreach ($citizenships as $citizenship): ?>
		<tr>
			<td>
				<a
					href="<?=base_url('persons/delete/'.$this->uri->segment(3, 0).'/'. $citizenship->prop_id.'/citizenships') ?>">
					<img src=<?=base_url("images/trash_s.png")?> class="beaicons" data-toggle="tooltip"
						data-placement="left" title="Delete">
				</a></td>
			<td><?=$citizenship->citizenship?></td>

		</tr>
		<?php endforeach?>

	</table>
	<!-- add new citizenship link using a modal with a dropdown -->
	<button class="btn btn-primary  view_detail" relid="<?= $this->session->userdata('person_id');  ?>">Add new citizenship</button>
	<a href="<?= site_url('persons') ?>" class="btn btn-secondary">Close</a>

</div>

<!-- modal -->
<div id="show_modal" class="modal fade" role="dialog">

	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h3> Add citizenship</h3>
			</div>
			<?= form_open('citizenships/add/'.$this->uri->segment(3, 0)) ;?>
			<div class="modal-body">
				<!-- dropdown with the existing citizenships-->
				<div><label for="cit_select">Citizenship</label>
					<select class="form-control" id="cit_select" name="cit_selection">
					</select>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-success">Save changes</button>
					<button type="button" class="btn btn-danger" id="reset" data-dismiss="modal"><i
							class="fa fa-times"></i>
						Close</button>
				</div>
			</div>
			<?= form_close() ;?>
		</div>

	</div>
</div>

<!-- script for modal -->
<script type="text/javascript">
	$(document).ready(function () {
		$('.view_detail').click(function () {
			var id = $(this).attr('relid'); //get the attribute value
			$.ajax({
				url: "<?php echo base_url(); ?>persons/exclude_existing_items",
				data: {
					id: id,
					id_name: 'citizen_id',
					type: 'citizenship',
					table: 'citizenships'
				},
				type: "post",
				dataType: 'json',
				success: function (response) {
					$.each(response, function (i) {
						$('#cit_select').append('<option value="' + response[i]
							.citizen_id + '"> ' + response[i].citizenship +
							'</option>'); //hold the response in id and show on popup
					});
					$('#show_modal').modal({
						backdrop: 'static',
						keyboard: true,
						show: true
					});
				}
			});
		});
	});

	//reset select data on cancel
	$(document).ready(function () {
		$("#reset").click(function () {
			$("#cit_select").empty();
		});
	});

</script>
</div>

<?php include 'footer.php';?>
